#!/usr/bin/env python
print("Content-Type: text/html; charset=UTF-8\n")

import glob
from os import path
import jinja2 as j2

# Find DB files
files = glob.glob('/var/www/html/data/db/*.stardb.*')

# Dict of labels of DB files
labels = {}

# Look for labels file
labels_file = '/var/www/html/data/db/labels'
if path.isfile(labels_file):
    with open(labels_file, 'r') as f:
        # Read each line, and put the filename and label in the dict
        for line in f.readlines():
            cols = line.split('=')
            labels[cols[0].strip()] = cols[1].strip()

# If there are files that do not have a label, generate one for them based on the filename
for fpath in files:
    fname = path.basename(fpath)
    if fname not in labels:
        labels[fname] = fname.split('.stardb.')[0]

# Load jinja template
jinja_env = j2.Environment(loader=j2.FileSystemLoader("templates"))
template = jinja_env.get_template("home.html")

# Render using DB list
print(template.render(dblist=labels))
