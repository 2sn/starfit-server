#!/usr/bin/env python
print("Content-Type: text/html; charset=UTF-8\n")

import cgi
import cgitb

cgitb.enable()

import sys
from datetime import datetime

from job import process
from sendmail import send_email
from utils import Config

start_time = datetime.now().strftime("%Y-%M-%d-%H-%M-%S")

# Retrieve form fields
c = Config(cgi.FieldStorage(), start_time)  # Get POST data and validate

page, body, imgfiles = process(c, start_time)

print(page)

if len(c.errors) > 0:
    sys.exit()

if c.mail:
    send_email(c, body, imgfiles, start_time)
