---
- name: Install dependencies
  dnf:
    name:
      - python
      - pip
      - python3-devel
      - python3-ipython
      - texlive
      - texlive-latex
      - texlive-type1cm
      - texlive-dvipng
      - gfortran
      - redis
    state: latest
  register: dnf

- name: Run texhash
  shell: texhash
  when: dnf.changed

- name: Install python deps
  pip:
    name:
      - wheel
      - jinja2
      - email-validator
      - rq
      - cerberus
      - pyyaml

- name: Install StarFit
  pip:
    name: starfit
    state: latest

- name: Run code to generate matplotlib and tex caches
  shell:
    cmd: sudo -u apache MPLCONFIGDIR={{ mplconfigdir }} python -c "import starfit; starfit.Single('HE1327-2326.dat').plot()"
